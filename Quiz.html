<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Devinez les raisons du silence</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;

      /* ✔ Fond mosaïque via URL absolue */
      background-image: url('https://avantpost-cpu.github.io/depot-quiz/fond.jpg');
      background-repeat: repeat;
      background-size: auto;
    }

    h2 { text-align: center; }

    #instructions { margin-bottom: 20px; font-size: 16px; line-height: 1.5; }

    .question {
      margin-bottom: 25px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: rgba(255,255,255,0.9);
    }

    button {
      display: block;
      margin: 5px 0;
      padding: 10px;
      width: 100%;
      cursor: pointer;
      border-radius: 5px;
      border: none;
      font-size: 15px;
    }

    button:hover { background: #f0f0f0; }

    #startBtn {
      background-color: #4f918d;
      color: white;
      font-weight: bold;
      padding: 12px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      display: block;
      margin: 20px auto;
      width: 200px;
      text-align: center;
    }

    #startBtn:hover { background-color: #3e736b; }

    .correct { color: green; font-weight: bold; }
    .wrong { color: red; font-weight: bold; }

    #score {
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      margin-top: 20px;
      display: none;
    }

    /* ✔ Timer masqué */
    #timerBarContainer { display: none; }

    #progress {
      text-align: center;
      margin-bottom: 10px;
      font-weight: bold;
      display: none;
    }

    .result-img {
      max-width: 50%;
      height: auto;
      display: block;
      margin: 20px auto 0 auto;
    }
  </style>
</head>

<body>
  <h2>Devinez les raisons du silence</h2>

  <p id="instructions">
    Ce quiz vous invite à deviner les raisons pour lesquelles certaines victimes gardent le silence dans le milieu sportif.
    Le compte à rebours n'est plus visible : répondez calmement.
    Le temps pris s’affichera après chaque réponse.
  </p>

  <button id="startBtn">Commencer le quiz</button>

  <div id="progress"></div>
  <div id="timerBarContainer"><div id="timerBar"></div></div>
  <div id="quiz"></div>
  <div id="score"></div>
  <div id="resultImage"></div>

  <script>
    /* ---------------------------
       DONNÉES DU QUIZ
       --------------------------- */
    var questions = [
      { text: "Quelles raisons peuvent conduire une victime à ne pas révéler ce qu’elle subit ?", answers: ["L’agresseur menace la carrière","Trop d’entraînements","Préférence pour la discrétion"], correct: 0 },
      { text: "Pourquoi le sentiment de loyauté vis-à-vis du club peut pousser au silence ?", answers: ["Par peur de nuire à l’image ou l’ambiance du club","Veut devenir capitaine","Pense que personne n’écoute"], correct: 0 },
      { text: "Menaces physiques : exemple ?", answers: ["Ne pas intervenir en cas de blessure","Entraînements supplémentaires","Récompenses"], correct: 0 },
      { text: "Pression familiale : effet sur le silence ?", answers: ["Peur de décevoir ou ne pas être cru","Famille encourage à parler","Famille indifférente"], correct: 0 },
      { text: "Culture de l’effort : effet sur le silence ?", answers: ["Violences perçues comme rite","Blessures toujours soignées","Douleur ignorée par coach"], correct: 0 },
      { text: "Culte de la virilité : effet sur le silence ?", answers: ["Honte de montrer vulnérabilité","Veut prouver sa force","Personne ne remarquera"], correct: 0 },
      { text: "Méfiance envers institutions : pourquoi ?", answers: ["Plaintes mal traitées","Préfère amis","Cherche conseils sportifs"], correct: 0 }
    ];

    var currentQuestion = 0;
    var score = 0;

    /* ✔ Variables pour mesurer le temps de réponse */
    var startTime = 0;
    var endTime = 0;
    var responseTime = 0;

    /* Liens DOM */
    var quizContainer = document.getElementById("quiz");
    var scoreContainer = document.getElementById("score");
    var progressContainer = document.getElementById("progress");
    var startBtn = document.getElementById("startBtn");
    var resultImage = document.getElementById("resultImage");

    /* Mélanger les réponses */
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    /* ------------------------------
       AFFICHER QUESTION
       ------------------------------ */
    function showQuestion() {
      if (currentQuestion >= questions.length) {
        quizContainer.innerHTML = "";
        progressContainer.textContent = "";

        scoreContainer.style.display = "block";
        scoreContainer.textContent = "Résultat final : " + score + " / " + questions.length;

        resultImage.innerHTML = "";
        if (score >= 5)
          resultImage.innerHTML = '<img src="bravo.png" alt="Bravo !" class="result-img">';
        else
          resultImage.innerHTML = '<img src="progres.png" alt="Progrès !" class="result-img">';

        return;
      }

      var q = questions[currentQuestion];
      var answers = q.answers.map((ans, index) => ({ text: ans, isCorrect: index === q.correct }));
      shuffleArray(answers);

      progressContainer.style.display = "block";
      progressContainer.textContent = "Question " + (currentQuestion + 1) + " / " + questions.length;

      var html = '<div class="question"><p><strong>' + q.text + '</strong></p>';
      for (var i = 0; i < answers.length; i++)
        html += '<button onclick="checkAnswer(' + i + ', ' + answers[i].isCorrect + ')">' + answers[i].text + '</button>';

      html += '<p id="feedback"></p></div>';

      quizContainer.innerHTML = html;

      /* ✔ Début du chrono invisible */
      startTime = performance.now();
    }

    /* ------------------------------
       RÉPONSE UTILISATEUR
       ------------------------------ */
    function checkAnswer(choiceIndex, isCorrect) {
      endTime = performance.now();
      responseTime = Math.round((endTime - startTime) / 1000);

      var feedback = document.getElementById("feedback");

      if (isCorrect) {
        feedback.textContent = "✅ Bonne réponse !";
        feedback.className = "correct";
      } else {
        feedback.textContent = "❌ Mauvaise réponse.";
        feedback.className = "wrong";
      }

      /* ✔ Ajout du temps de réponse */
      feedback.innerHTML +=
        "<br><span style='opacity:0.7;'>⏱ Temps pris : <strong>" + responseTime + " s</strong></span>";

      if (isCorrect) score++;

      setTimeout(function () {
        currentQuestion++;
        showQuestion();
      }, 1200);
    }

    /* ------------------------------
       DÉMARRAGE DU QUIZ
       ------------------------------ */
    startBtn.addEventListener("click", function () {
      startBtn.style.display = "none";
      quizContainer.style.display = "block";
      scoreContainer.style.display = "none";
      showQuestion();
    });
  </script>
</body>
</html>
