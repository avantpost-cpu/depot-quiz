<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Questionnaire pour Alma – Nombres relatifs</title>

<style>
:root{
  --bg-main:#ece9e4;
  --bg-card:#f4f1ec;
  --ink-main:#0b0f2b;
  --ink-soft:#6b6f7a;
  --accent-blue:#3f72f4;
  --accent-pink:#ff9fd6;
  --accent-coral:#ef6234;
  --border:#ddd8cf;
}

*{box-sizing:border-box}

body{
  margin:0;
  padding:20px;
  background:var(--bg-main);
  color:var(--ink-main);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  display:flex;
  justify-content:center;
}

.app{
  width:min(1200px,100%);
  background:var(--bg-card);
  border-radius:18px;
  padding:24px;
  box-shadow:0 16px 36px rgba(11,15,43,.12);
}

/* ===== HEADER ===== */
.header{
  display:grid;
  grid-template-columns: 1fr auto;
  gap:20px;
  align-items:center;
}

h1{
  margin:0;
  font-size:34px;
  font-weight:800;
  letter-spacing:-0.02em;
}

.sub{
  margin-top:6px;
  font-size:14px;
  color:var(--ink-soft);
}

/* ===== SNOOPY (HEADER) ===== */
.snoopyHeader img{
  max-width:130px;
  height:auto;
  border-radius:12px;
  /* volontairement AUCUNE ombre */
}

/* ===== MAIN LAYOUT ===== */
.main{
  display:grid;
  grid-template-columns: 1.6fr 1fr;
  gap:22px;
  margin-top:20px;
}

/* ===== STATS ===== */
.stats{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin:14px 0;
}
.stat{
  background:#fff;
  padding:6px 12px;
  border-radius:999px;
  font-size:13px;
  border:1px solid var(--border);
}

/* ===== CONTROLS ===== */
.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:12px;
}
select, input{
  padding:8px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#fff;
  color:var(--ink-main);
  font-size:14px;
}
button{
  cursor:pointer;
  border-radius:14px;
  padding:8px 14px;
  font-weight:700;
  border:1px solid var(--border);
  background:#fff;
  color:var(--ink-main);
}

/* ===== QUIZ ===== */
.question{
  font-size:32px;
  margin:14px 0;
}
.answers{
  display:grid;
  gap:10px;
}
.choice{
  background:#fff;
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  font-size:16px;
}
.choice:hover{border-color:var(--accent-blue)}
.choice.ok{background:#eef6ff;border-color:var(--accent-blue)}
.choice.bad{background:#fff0f0;border-color:var(--accent-coral)}

.feedback{
  margin-top:10px;
  padding:10px 12px;
  border-radius:12px;
  background:#fff;
  font-size:14px;
  border-left:4px solid var(--accent-blue);
}

/* ===== MINI LEÇON ===== */
.lesson{
  background:#fff;
  border-radius:16px;
  padding:18px;
  border:1px solid var(--border);
}
.lesson h2{
  margin:0 0 10px;
  font-size:18px;
}
.lesson ul{
  margin:0;
  padding-left:18px;
  color:var(--ink-soft);
  line-height:1.45;
}
.lesson li{margin-bottom:8px}
.lesson .example{
  background:#f7f7f7;
  border-radius:10px;
  padding:10px 12px;
  font-size:13px;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="app">

<!-- ===== HEADER ===== -->
<div class="header">
  <div>
    <h1>Questionnaire pour Alma</h1>
    <div class="sub">Additions et soustractions de nombres relatifs</div>
  </div>

  <div class="snoopyHeader">
    <img id="snoopyImg"
         src="https://avantpost-cpu.github.io/depot-quiz/snoopy_calm.png"
         alt="">
  </div>
</div>

<!-- ===== MAIN ===== -->
<div class="main">

<!-- ===== QUIZ ===== -->
<div>
  <div class="stats">
    <div class="stat">Question <b id="qnum">1</b> / 20</div>
    <div class="stat">Score <b id="score">0</b></div>
    <div class="stat">Série <b id="streak">0</b></div>
  </div>

  <div class="controls">
    <select id="level">
      <option value="10">Facile (±10)</option>
      <option value="20" selected>Moyen (±20)</option>
      <option value="50">Plus dur (±50)</option>
    </select>

    <select id="mode">
      <option value="qcm" selected>QCM</option>
      <option value="input">Saisie</option>
    </select>

    <button id="restart">Recommencer</button>
  </div>

  <div class="question" id="question">—</div>
  <div class="answers" id="answers"></div>
  <div class="feedback" id="feedback" style="display:none"></div>
</div>

<!-- ===== MINI LEÇON ===== -->
<div class="lesson">
  <h2>Mini-leçon</h2>
  <ul>
    <li><b>Addition</b> : mêmes signes → on additionne, on garde le signe.</li>
    <li>Signes différents → on soustrait, on garde le signe du plus grand.</li>
    <li><b>Soustraction</b> : soustraire = ajouter l’opposé.</li>
  </ul>

  <div class="example">
    Exemples :<br>
    7 − (−3) = 10<br>
    −8 + 5 = −3
  </div>
</div>

</div>
</div>

<script>
const TOTAL = 20;

// ✅ Base GitHub Pages (sans "images/")
const BASE = "https://avantpost-cpu.github.io/depot-quiz/";

const SNOOPY = {
  calm: BASE + "snoopy_calm.png",
  happy: BASE + "snoopy_happy.png",
  encourage: BASE + "snoopy_encourage.png"
};

let index = 1, score = 0, streak = 0;
let answer = 0;

const qnum = document.getElementById("qnum");
const scoreEl = document.getElementById("score");
const streakEl = document.getElementById("streak");
const qEl = document.getElementById("question");
const answersEl = document.getElementById("answers");
const feedbackEl = document.getElementById("feedback");
const snoopyImg = document.getElementById("snoopyImg");

function rand(limit){
  let n = 0;
  while(n === 0) n = Math.floor(Math.random()*(2*limit+1)) - limit;
  return n;
}
function fmt(n){ return n < 0 ? "−" + Math.abs(n) : n; }

function newQuestion(){
  feedbackEl.style.display = "none";
  answersEl.innerHTML = "";
  snoopyImg.src = SNOOPY.calm;

  const limit = +level.value;
  const a = rand(limit);
  const b = rand(limit);
  const op = Math.random() < 0.5 ? "+" : "−";

  answer = (op === "+") ? (a + b) : (a - b);

  qEl.textContent = `${fmt(a)} ${op} ${fmt(b)}`;

  if(mode.value === "qcm"){
    const set = new Set([answer]);
    while(set.size < 4) set.add(answer + Math.floor(Math.random()*5) - 2);

    [...set].sort(() => Math.random() - 0.5).forEach(v => {
      const btn = document.createElement("button");
      btn.className = "choice";
      btn.textContent = fmt(v);
      btn.onclick = () => check(v, btn);
      answersEl.appendChild(btn);
    });
  } else {
    const input = document.createElement("input");
    input.placeholder = "Ta réponse (ex : -7)";
    input.type = "text";
    input.inputMode = "numeric";
    input.autocomplete = "off";

    const btn = document.createElement("button");
    btn.textContent = "Valider";

    function submit(){
      const cleaned = input.value.trim().replace("−","-");
      const val = Number(cleaned);
      if(!Number.isFinite(val)){
        feedbackEl.style.display = "block";
        feedbackEl.textContent = "Écris un nombre (ex : -7).";
        snoopyImg.src = SNOOPY.encourage;
        return;
      }
      check(val, null);
    }

    btn.onclick = submit;
    input.onkeydown = (e) => { if(e.key === "Enter") submit(); };

    answersEl.append(input, btn);
    setTimeout(() => input.focus(), 0);
  }
}

function check(val, btn){
  const ok = (val === answer);

  if(ok){
    score++;
    streak++;
    snoopyImg.src = SNOOPY.happy;
  } else {
    streak = 0;
    snoopyImg.src = SNOOPY.encourage;
  }

  feedbackEl.style.display = "block";
  feedbackEl.textContent = `Réponse correcte : ${fmt(answer)}`;

  scoreEl.textContent = score;
  streakEl.textContent = streak;

  // Avancer dans la session
  index++;
  qnum.textContent = Math.min(index, TOTAL);

  if(index <= TOTAL){
    setTimeout(newQuestion, 900);
  } else {
    // Fin simple (sans écran séparé, pour rester "tout sur un écran")
    feedbackEl.textContent = `Fin de session : ${score}/${TOTAL}. (Recommencer pour rejouer)`;
    snoopyImg.src = SNOOPY.happy;
  }
}

restart.onclick = () => {
  index = 1; score = 0; streak = 0;
  qnum.textContent = 1;
  scoreEl.textContent = 0;
  streakEl.textContent = 0;
  feedbackEl.style.display = "none";
  snoopyImg.src = SNOOPY.calm;
  newQuestion();
};

mode.onchange = newQuestion;
level.onchange = newQuestion;

newQuestion();
</script>

</body>
</html>
