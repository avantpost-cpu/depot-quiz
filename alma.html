<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Entra√Ænement ‚Äì Nombres relatifs (12 ans)</title>
  <style>
    :root{
      --bg:#0b1220; --card:#121b2f; --muted:#98a2b3; --txt:#e5e7eb;
      --ok:#22c55e; --bad:#ef4444; --accent:#60a5fa; --accent2:#fbbf24;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1000px 600px at 20% 10%, #1b2a52 0%, transparent 60%),
                  radial-gradient(900px 600px at 80% 20%, #2a1b52 0%, transparent 55%),
                  var(--bg);
      color:var(--txt);
      padding:24px;
      display:flex; justify-content:center;
    }
    .app{width:min(920px, 100%); display:grid; gap:16px}
    .top{
      background: linear-gradient(135deg, rgba(96,165,250,.18), rgba(251,191,36,.12));
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      padding:16px 18px;
      box-shadow: var(--shadow);
      display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between; gap:12px;
    }
    h1{font-size:18px; margin:0}
    .sub{color:var(--muted); font-size:13px; margin-top:2px}
    .stats{display:flex; gap:14px; flex-wrap:wrap; align-items:center}
    .pill{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      padding:8px 10px; border-radius: 999px;
      font-size:13px; color:#e9edf6;
      display:flex; gap:8px; align-items:center;
    }
    .pill b{font-weight:700}
    .grid{display:grid; grid-template-columns: 1.15fr .85fr; gap:16px}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }
    .card{
      background: rgba(18,27,47,.92);
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    label{font-size:13px; color:var(--muted)}
    select, input[type="number"], input[type="text"]{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      color:var(--txt);
      border-radius: 12px;
      padding:10px 12px;
      outline:none;
    }
    select{cursor:pointer}
    button{
      cursor:pointer;
      border:0;
      border-radius: 14px;
      padding:10px 12px;
      font-weight:700;
      color:#0b1220;
      background: linear-gradient(135deg, var(--accent), #93c5fd);
      box-shadow: 0 10px 20px rgba(96,165,250,.25);
    }
    button.secondary{
      color:var(--txt);
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      box-shadow:none;
    }
    button.warn{
      background: linear-gradient(135deg, #fca5a5, #fb7185);
      box-shadow: 0 10px 20px rgba(239,68,68,.18);
    }
    .question{
      font-size:34px;
      letter-spacing: .3px;
      margin:12px 0 10px;
      display:flex; align-items:baseline; gap:10px; flex-wrap:wrap;
    }
    .qtag{
      font-size:12px;
      color:#111827;
      background: rgba(251,191,36,.95);
      padding:4px 8px;
      border-radius: 999px;
      font-weight:800;
    }
    .help{color:var(--muted); font-size:13px; line-height:1.35}
    .answers{display:grid; gap:10px; margin-top:12px}
    .choice{
      text-align:left;
      width:100%;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      color:var(--txt);
      padding:12px;
      border-radius: 14px;
      font-weight:700;
    }
    .choice:hover{border-color: rgba(96,165,250,.55)}
    .ok{border-color: rgba(34,197,94,.65)!important; background: rgba(34,197,94,.12)!important}
    .bad{border-color: rgba(239,68,68,.65)!important; background: rgba(239,68,68,.10)!important}
    .feedback{
      margin-top:12px; padding:12px; border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      font-size:14px;
    }
    .feedback.ok{border-color: rgba(34,197,94,.55); background: rgba(34,197,94,.10)}
    .feedback.bad{border-color: rgba(239,68,68,.55); background: rgba(239,68,68,.08)}
    .small{font-size:12px; color:var(--muted)}
    .divider{height:1px; background: rgba(255,255,255,.10); margin:14px 0}
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      padding:2px 6px; border-radius: 8px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:#e8eefc;
      font-size:12px;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="top">
      <div>
        <h1>Entra√Ænement ‚Äì Nombres relatifs</h1>
        <div class="sub">Additions, soustractions, produits, priorit√©s. Correction imm√©diate + explication.</div>
      </div>
      <div class="stats">
        <div class="pill">‚úÖ Score : <b id="score">0</b> / <b id="done">0</b></div>
        <div class="pill">üî• S√©rie : <b id="streak">0</b></div>
        <div class="pill">‚è±Ô∏è Temps : <b id="time">00:00</b></div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="row" style="justify-content:space-between; gap:12px">
          <div class="row">
            <div>
              <label for="mode">Mode</label><br>
              <select id="mode">
                <option value="mix">Mix</option>
                <option value="addsub">Add / Sub</option>
                <option value="mul">Produits</option>
                <option value="prio">Priorit√©s</option>
                <option value="compare">Comparer</option>
              </select>
            </div>
            <div>
              <label for="level">Difficult√©</label><br>
              <select id="level">
                <option value="1">Facile (¬±1 √† ¬±10)</option>
                <option value="2" selected>Moyen (¬±1 √† ¬±20)</option>
                <option value="3">Plus dur (¬±1 √† ¬±50)</option>
              </select>
            </div>
            <div>
              <label for="inputMode">R√©ponse</label><br>
              <select id="inputMode">
                <option value="qcm" selected>QCM (4 choix)</option>
                <option value="saisie">Saisie (au clavier)</option>
              </select>
            </div>
          </div>
          <div class="row">
            <button class="secondary" id="btnSkip" title="Passer">Passer</button>
            <button class="warn" id="btnReset" title="Remettre √† z√©ro">Reset</button>
          </div>
        </div>

        <div class="divider"></div>

        <div class="question">
          <span class="qtag" id="tag">MIX</span>
          <span id="qtext">‚Äî</span>
        </div>
        <div class="help" id="hint">Astuce : soustraire un n√©gatif, c‚Äôest ajouter son oppos√©. (ex : 7 ‚àí (‚àí3) = 7 + 3)</div>

        <div id="areaQCM" class="answers" aria-live="polite"></div>

        <div id="areaSaisie" style="display:none; margin-top:12px">
          <div class="row" style="gap:10px; align-items:flex-end">
            <div style="flex:1">
              <label for="userAnswer">Ta r√©ponse</label><br>
              <input id="userAnswer" type="text" inputmode="numeric" placeholder="Ex : -7" style="width:100%" />
              <div class="small" style="margin-top:6px">Astuce : utilise le signe moins <span class="kbd">-</span>. Puis <span class="kbd">Entr√©e</span> pour valider.</div>
            </div>
            <button id="btnCheck">V√©rifier</button>
          </div>
        </div>

        <div id="feedback" class="feedback" style="display:none"></div>

      </div>

      <div class="card">
        <h2 style="margin:0 0 8px; font-size:16px">Mini-le√ßon (rappels)</h2>
        <div class="help">
          <ul style="margin:8px 0 0 18px; padding:0; line-height:1.45">
            <li><b>Addition</b> : m√™mes signes ‚Üí on additionne, on garde le signe. Signes diff√©rents ‚Üí on soustrait, on garde le signe du plus grand en valeur.</li>
            <li><b>Soustraction</b> : <span class="kbd">a ‚àí b</span> = <span class="kbd">a + (‚àíb)</span>.</li>
            <li><b>Produit</b> : m√™me signe ‚Üí positif. Signes diff√©rents ‚Üí n√©gatif.</li>
            <li><b>Priorit√©s</b> : parenth√®ses ‚Üí multiplications ‚Üí additions/soustractions.</li>
          </ul>
          <div class="divider"></div>
          <div class="row" style="justify-content:space-between">
            <div class="small">Conseil : 10 min par jour = tr√®s efficace.</div>
            <div class="small">Objectif : 20 bonnes r√©ponses d‚Äôaffil√©e üî•</div>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
(() => {
  // ---------- √âTAT ----------
  const state = {
    score: 0,
    done: 0,
    streak: 0,
    current: null,
    startTs: Date.now(),
    timer: null,
  };

  // ---------- UI ----------
  const $ = (id) => document.getElementById(id);
  const scoreEl = $("score");
  const doneEl = $("done");
  const streakEl = $("streak");
  const timeEl = $("time");
  const modeEl = $("mode");
  const levelEl = $("level");
  const inputModeEl = $("inputMode");
  const tagEl = $("tag");
  const qtextEl = $("qtext");
  const hintEl = $("hint");
  const areaQCM = $("areaQCM");
  const areaSaisie = $("areaSaisie");
  const userAnswer = $("userAnswer");
  const btnCheck = $("btnCheck");
  const feedbackEl = $("feedback");

  function pad2(n){ return String(n).padStart(2,"0"); }
  function formatTime(ms){
    const s = Math.floor(ms/1000);
    const m = Math.floor(s/60);
    const r = s % 60;
    return `${pad2(m)}:${pad2(r)}`;
  }
  function updateStats(){
    scoreEl.textContent = state.score;
    doneEl.textContent = state.done;
    streakEl.textContent = state.streak;
  }
  function showFeedback(ok, html){
    feedbackEl.style.display = "block";
    feedbackEl.classList.toggle("ok", ok);
    feedbackEl.classList.toggle("bad", !ok);
    feedbackEl.innerHTML = html;
  }
  function clearFeedback(){
    feedbackEl.style.display = "none";
    feedbackEl.classList.remove("ok","bad");
    feedbackEl.innerHTML = "";
  }

  // ---------- G√âN√âRATION ----------
  function randint(min, max){ // inclusif
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }
  function nonZeroInt(limit){
    let x = 0;
    while(x === 0) x = randint(-limit, limit);
    return x;
  }
  function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  function limits(){
    const lv = Number(levelEl.value);
    if(lv === 1) return 10;
    if(lv === 2) return 20;
    return 50;
  }

  function buildQuestion(){
    const L = limits();
    const mode = modeEl.value === "mix"
      ? pick(["addsub","mul","prio","compare"])
      : modeEl.value;

    let q = { mode, text:"", answer:null, explain:"", hint:"" };

    if(mode === "addsub"){
      const a = nonZeroInt(L);
      const b = nonZeroInt(L);
      const op = pick(["+","-"]);
      if(op === "+"){
        q.text = `${fmt(a)} + ${fmtPar(b)}`;
        q.answer = a + b;
        q.explain = explainAdd(a,b);
        q.hint = "Rappel : m√™mes signes ‚Üí on additionne, signes diff√©rents ‚Üí on soustrait.";
      } else {
        q.text = `${fmt(a)} ‚àí ${fmtPar(b)}`;
        q.answer = a - b;
        q.explain = `On transforme : ${fmt(a)} ‚àí ${fmtPar(b)} = ${fmt(a)} + (${fmt(-b)})<br>` + explainAdd(a, -b);
        q.hint = "Astuce : soustraire un nombre, c‚Äôest ajouter son oppos√©.";
      }
    }

    if(mode === "mul"){
      const a = nonZeroInt(Math.max(3, Math.floor(L/2)));
      const b = nonZeroInt(Math.max(3, Math.floor(L/2)));
      q.text = `${fmtPar(a)} √ó ${fmtPar(b)}`;
      q.answer = a * b;
      const sign = (a*b >= 0) ? "positif" : "n√©gatif";
      q.explain = `Signes : ${a<0?"‚àí":"+"} √ó ${b<0?"‚àí":"+"} ‚Üí r√©sultat ${sign}.<br>
                   Valeurs : |${a}| √ó |${b}| = ${Math.abs(a)} √ó ${Math.abs(b)} = ${Math.abs(a*b)}.`;
      q.hint = "Produit : m√™me signe ‚Üí + ; signe diff√©rent ‚Üí ‚àí.";
    }

    if(mode === "prio"){
      // Forme : a + (b √ó c)  ou  (a ‚àí b) √ó c  (niveau 2/3)
      const lv = Number(levelEl.value);
      const a = nonZeroInt(Math.max(10, Math.floor(L/2)));
      const b = nonZeroInt(Math.max(10, Math.floor(L/2)));
      const c = nonZeroInt(Math.max(6, Math.floor(L/3)));
      if(lv === 1){
        // parenth√®se simple
        q.text = `${fmt(a)} + (${fmt(b)} √ó ${fmt(c)})`;
        q.answer = a + (b*c);
        q.explain = `Priorit√©s : on calcule d‚Äôabord la multiplication.<br>
                     ${fmt(b)} √ó ${fmt(c)} = ${fmt(b*c)} puis ${fmt(a)} + ${fmt(b*c)} = ${fmt(q.answer)}.`;
      } else {
        const form = pick(["a_plus_bxc", "a_min_b_par_c"]);
        if(form === "a_plus_bxc"){
          q.text = `${fmt(a)} ‚àí (${fmtPar(b)} √ó ${fmtPar(c)})`;
          q.answer = a - (b*c);
          q.explain = `1) Multiplication : ${fmtPar(b)} √ó ${fmtPar(c)} = ${fmt(b*c)}<br>
                       2) Puis soustraction : ${fmt(a)} ‚àí ${fmtPar(b*c)} = ${fmt(q.answer)}.`;
        } else {
          q.text = `(${fmt(a)} ‚àí ${fmtPar(b)}) √ó ${fmtPar(c)}`;
          q.answer = (a - b) * c;
          q.explain = `1) Parenth√®ses : ${fmt(a)} ‚àí ${fmtPar(b)} = ${fmt(a-b)}<br>
                       2) Multiplication : ${fmt(a-b)} √ó ${fmtPar(c)} = ${fmt(q.answer)}.`;
        }
      }
      q.hint = "Priorit√©s : parenth√®ses ‚Üí multiplications ‚Üí +/‚àí.";
    }

    if(mode === "compare"){
      const a = nonZeroInt(L);
      const b = nonZeroInt(L);
      // question "Quel est le plus grand ?"
      q.text = `Quel est le plus grand ?  ${fmt(a)}  et  ${fmt(b)}`;
      q.answer = (a > b) ? "A" : (b > a ? "B" : "E");
      q.explain = (a === b)
        ? `Ils sont √©gaux : ${fmt(a)} = ${fmt(b)}.`
        : `Sur la droite gradu√©e, le plus grand est celui qui est le plus √† droite :<br>
           ${fmt(a)} ${a>b?">":"<"} ${fmt(b)}.`;
      q.hint = "Rappel : parmi les n√©gatifs, celui qui est le ‚Äúmoins loin‚Äù de 0 est le plus grand.";
    }

    return q;
  }

  function fmt(n){
    return (n < 0) ? `‚àí${Math.abs(n)}` : `${n}`;
  }
  function fmtPar(n){
    return (n < 0) ? `(${fmt(n)})` : fmt(n);
  }

  function explainAdd(a,b){
    const sameSign = (a>=0 && b>=0) || (a<0 && b<0);
    if(sameSign){
      const s = a+b;
      return `M√™mes signes ‚Üí on additionne : |${fmt(a)}| + |${fmt(b)}| = ${Math.abs(a)} + ${Math.abs(b)} = ${Math.abs(s)}.<br>
              On garde le signe : r√©sultat = ${fmt(s)}.`;
    } else {
      const s = a+b;
      const big = (Math.abs(a) >= Math.abs(b)) ? a : b;
      return `Signes diff√©rents ‚Üí on soustrait : ${Math.max(Math.abs(a),Math.abs(b))} ‚àí ${Math.min(Math.abs(a),Math.abs(b))} = ${Math.abs(s)}.<br>
              On garde le signe du plus grand en valeur (${fmt(big)}) : r√©sultat = ${fmt(s)}.`;
    }
  }

  // ---------- QCM ----------
  function makeChoices(q){
    // 4 choix dont 1 correct (ou cas compare)
    let correct = q.answer;
    let choices = [];

    if(q.mode === "compare"){
      // A = premier, B = second, E = √©gaux
      const labels = [
        {key:"A", txt:"Le 1er"},
        {key:"B", txt:"Le 2e"},
        {key:"E", txt:"Ils sont √©gaux"},
        {key:"N", txt:"Impossible √† savoir"}
      ];
      // remplace N par un distracteur raisonnable
      choices = shuffle(labels).slice(0,4);
      // s'assurer que la bonne r√©ponse est pr√©sente
      if(!choices.some(x => x.key === correct)){
        choices[0] = labels.find(x => x.key === correct);
      }
      return { choices, correct };
    }

    choices.push(correct);

    // distracteurs : +/- 1, inversion signe, oubli de parenth√®ses
    const d1 = correct + pick([-2,-1,1,2]);
    const d2 = -correct;
    const d3 = (q.mode === "mul" || q.mode === "prio") ? correct + pick([-5,5,-10,10]) : correct + pick([-3,3]);

    [d1,d2,d3].forEach(v => { if(!choices.includes(v)) choices.push(v); });

    while(choices.length < 4){
      const v = correct + randint(-12,12);
      if(v !== correct && !choices.includes(v)) choices.push(v);
    }

    choices = shuffle(choices).slice(0,4);
    return { choices, correct };
  }

  function shuffle(arr){
    const a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]] = [a[j],a[i]];
    }
    return a;
  }

  // ---------- FLUX ----------
  function renderQuestion(){
    clearFeedback();
    state.current = buildQuestion();

    const q = state.current;
    tagEl.textContent = q.mode.toUpperCase();
    qtextEl.textContent = q.text;
    hintEl.innerHTML = q.hint || "";

    const inputMode = inputModeEl.value;

    areaQCM.innerHTML = "";
    if(inputMode === "qcm"){
      areaQCM.style.display = "grid";
      areaSaisie.style.display = "none";

      const { choices, correct } = makeChoices(q);
      choices.forEach((c) => {
        const btn = document.createElement("button");
        btn.className = "choice";
        if(q.mode === "compare"){
          btn.textContent = c.txt;
          btn.dataset.val = c.key;
        } else {
          btn.textContent = fmt(c);
          btn.dataset.val = String(c);
        }
        btn.addEventListener("click", () => checkAnswer(btn.dataset.val, btn));
        areaQCM.appendChild(btn);
      });
    } else {
      areaQCM.style.display = "none";
      areaSaisie.style.display = "block";
      userAnswer.value = "";
      userAnswer.focus();
    }
  }

  function checkAnswer(raw, clickedBtn=null){
    const q = state.current;
    let userVal;

    if(q.mode === "compare"){
      userVal = String(raw).trim().toUpperCase();
      const ok = userVal === q.answer;
      afterAnswer(ok, clickedBtn, userVal);
      return;
    }

    // autoriser "‚àí" ou "-"
    const cleaned = String(raw).trim().replace("‚àí","-");
    userVal = Number(cleaned);

    if(!Number.isFinite(userVal)){
      showFeedback(false, `Je ne comprends pas la r√©ponse. Essaie un nombre comme <span class="kbd">-7</span>.`);
      return;
    }

    const ok = userVal === q.answer;
    afterAnswer(ok, clickedBtn, userVal);
  }

  function afterAnswer(ok, clickedBtn, userVal){
    const q = state.current;

    state.done += 1;

    if(ok){
      state.score += 1;
      state.streak += 1;
    } else {
      state.streak = 0;
    }
    updateStats();

    // Marquer les boutons en QCM
    if(inputModeEl.value === "qcm"){
      const btns = [...areaQCM.querySelectorAll("button")];
      btns.forEach(b => {
        const v = b.dataset.val;
        const isCorrect = (q.mode === "compare") ? (v === q.answer) : (Number(v) === q.answer);
        if(isCorrect) b.classList.add("ok");
      });
      if(clickedBtn && !ok) clickedBtn.classList.add("bad");
      btns.forEach(b => b.disabled = true);
    }

    const goodTxt = (q.mode === "compare")
      ? `Bonne r√©ponse ‚úÖ`
      : `Bonne r√©ponse ‚úÖ <b>${fmt(q.answer)}</b>`;

    const badTxt = (q.mode === "compare")
      ? `Rat√© ‚ùå La bonne r√©ponse √©tait : <b>${q.answer==="A"?"Le 1er":q.answer==="B"?"Le 2e":"Ils sont √©gaux"}</b>`
      : `Rat√© ‚ùå Ta r√©ponse : <b>${fmt(Number.isFinite(userVal)?userVal:0)}</b> ‚Äî Bonne r√©ponse : <b>${fmt(q.answer)}</b>`;

    showFeedback(ok, `
      <div style="font-weight:800; margin-bottom:6px">${ok ? goodTxt : badTxt}</div>
      <div>${q.explain}</div>
      <div class="small" style="margin-top:8px">Prochaine question dans 1 seconde‚Ä¶</div>
    `);

    setTimeout(renderQuestion, 1000);
  }

  // ---------- EVENTS ----------
  inputModeEl.addEventListener("change", renderQuestion);
  modeEl.addEventListener("change", renderQuestion);
  levelEl.addEventListener("change", renderQuestion);

  btnCheck.addEventListener("click", () => checkAnswer(userAnswer.value));
  userAnswer.addEventListener("keydown", (e) => {
    if(e.key === "Enter") checkAnswer(userAnswer.value);
  });

  $("btnSkip").addEventListener("click", () => renderQuestion());

  $("btnReset").addEventListener("click", () => {
    state.score = 0; state.done = 0; state.streak = 0;
    state.startTs = Date.now();
    updateStats();
    clearFeedback();
    renderQuestion();
  });

  // ---------- TIMER ----------
  function startTimer(){
    if(state.timer) clearInterval(state.timer);
    state.timer = setInterval(() => {
      timeEl.textContent = formatTime(Date.now() - state.startTs);
    }, 250);
  }

  // ---------- INIT ----------
  updateStats();
  startTimer();
  renderQuestion();
})();
</script>
</body>
</html>
