<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Un musée imaginaire</title>

<style>
/* =========================
   Base
   ========================= */
:root{
  --bg: #f0f0f3;
  --txt: #111;
  --muted: rgba(17,17,17,.62);
  --hair: rgba(17,17,17,.12);
  --maxW: 1100px;
  --scale: .8;
}

html, body{
  margin:0;
  padding:0;
  height:100%;
  background:var(--bg);
  color:var(--txt);
  display:block;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
}

/* =========================
   Header (menu design, très discret)
   ========================= */
.header{
  position:sticky;
  top:0;
  z-index:10;
  background:linear-gradient(to bottom, rgba(240,240,243,.92), rgba(240,240,243,.76));
  backdrop-filter: blur(8px);
  border-bottom:1px solid var(--hair);
}

.header-inner{
  max-width:var(--maxW);
  margin:0 auto;
  padding:14px 16px;
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:18px;
}

.brand{
  font-size:14px;
  font-weight:600;
  letter-spacing:.22px;
  text-decoration:none;
  color:inherit;
}

.nav{
  display:flex;
  gap:16px;
  font-size:13px;
  letter-spacing:.18px;
}

.nav a, .nav button{
  appearance:none;
  border:0;
  background:none;
  padding:0;
  margin:0;
  cursor:pointer;

  color:var(--muted);
  text-decoration:none;
  font: inherit;
}

.nav a:hover, .nav button:hover{ color:var(--txt); }
.nav a:focus-visible, .nav button:focus-visible{
  outline:2px solid rgba(0,0,0,.25);
  outline-offset:3px;
  border-radius:6px;
}

/* petit indicateur état */
.state{
  font-size:12px;
  color:rgba(17,17,17,.5);
  letter-spacing:.15px;
  white-space:nowrap;
}

/* =========================
   Scène (mosaïque + overlays)
   ========================= */
.stage{
  width:100%;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding-top:0;
  box-sizing:border-box;
}

.scene{
  position:relative;
  width:100%;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  overflow:hidden;

  perspective: 1900px;
  perspective-origin: 50% 18%;
}

/* MOSAÏQUE INTRO (accueil) */
.mosaic{
  display:grid;
  gap:0;
  line-height:0;
  font-size:0;
  background:#fff;
  overflow:hidden;

  transform: scale(var(--scale));
  transform-origin: top center;

  transition:
    transform 1.25s cubic-bezier(.22, 1, .36, 1),
    opacity   1.25s cubic-bezier(.22, 1, .36, 1),
    filter    1.25s cubic-bezier(.22, 1, .36, 1);
  will-change: transform, opacity, filter;
}

.mosaic img{
  display:block;
  width:100%;
  height:auto;
  margin:0;
  padding:0;
  border:0;
}

.top{ grid-column: 1 / -1; }

.cell2, .cell4{
  position:relative;
  overflow:hidden;
}

/* zone cliquable/transparente */
.hotspot{
  position:absolute;
  inset:0;
  display:block;
  background:transparent;
  cursor:pointer;
}

/* OVERLAYS (Couleurs / Photos) */
.overlay{
  position:absolute;
  top:0;
  left:50%;
  transform-origin: top center;

  opacity:0;
  filter: blur(3px);
  pointer-events:none;

  transition:
    transform 1.35s cubic-bezier(.22, 1, .36, 1),
    opacity   1.35s cubic-bezier(.22, 1, .36, 1),
    filter    1.35s cubic-bezier(.22, 1, .36, 1);
  will-change: transform, opacity, filter;
}

/* un léger délai rend l’arrivée plus “loin / timidement” */
.scene.preview-couleurs #couleurs,
.scene.preview-photos #photos,
.scene.lock-couleurs #couleurs,
.scene.lock-photos #photos{
  transition-delay: 90ms, 90ms, 90ms;
}

/* départ plus loin */
#couleurs{
  transform:
    translateX(-50%)
    translateX(-46%)
    rotateY(18deg)
    translateZ(-120px)
    scale(calc(var(--scale) * 0.88));
}

#photos{
  transform:
    translateX(-50%)
    translateX(46%)
    rotateY(-18deg)
    translateZ(-120px)
    scale(calc(var(--scale) * 0.88));
}

/* PREVIEW (hover) */
.scene.preview-couleurs .mosaic{
  transform:
    translateX(30%)
    rotateY(-14deg)
    translateZ(-60px)
    scale(calc(var(--scale) * 0.96));
  opacity:0;
  filter: blur(2px);
}

.scene.preview-couleurs #couleurs{
  transform:
    translateX(-50%)
    translateX(0%)
    rotateY(0deg)
    translateZ(0px)
    scale(var(--scale));
  opacity:1;
  filter: blur(0px);
}

.scene.preview-photos .mosaic{
  transform:
    translateX(-30%)
    rotateY(14deg)
    translateZ(-60px)
    scale(calc(var(--scale) * 0.96));
  opacity:0;
  filter: blur(2px);
}

.scene.preview-photos #photos{
  transform:
    translateX(-50%)
    translateX(0%)
    rotateY(0deg)
    translateZ(0px)
    scale(var(--scale));
  opacity:1;
  filter: blur(0px);
}

/* LOCK (clic) */
.scene.lock-couleurs .mosaic,
.scene.lock-photos .mosaic{
  opacity:0;
  filter: blur(2px);
}

.scene.lock-couleurs .mosaic{
  transform:
    translateX(30%)
    rotateY(-14deg)
    translateZ(-60px)
    scale(calc(var(--scale) * 0.96));
}

.scene.lock-photos .mosaic{
  transform:
    translateX(-30%)
    rotateY(14deg)
    translateZ(-60px)
    scale(calc(var(--scale) * 0.96));
}

.scene.lock-couleurs #couleurs{
  transform:
    translateX(-50%)
    translateX(0%)
    rotateY(0deg)
    translateZ(0px)
    scale(var(--scale));
  opacity:1;
  filter: blur(0px);
  pointer-events:auto;
}

.scene.lock-photos #photos{
  transform:
    translateX(-50%)
    translateX(0%)
    rotateY(0deg)
    translateZ(0px)
    scale(var(--scale));
  opacity:1;
  filter: blur(0px);
  pointer-events:auto;
}

/* un petit espace visuel entre header et œuvre */
.spacer{ height:10px; }

/* =========================
   PAGE COULEURS = mosaïque Obra_1..19
   -> bord franc, aucun effet, aucun crop
   ========================= */
#couleurs .obra-grid{
  width:min(92vw, var(--maxW));
  display:grid;
  gap:0;                 /* bord franc */
  padding:0;
  background:transparent;
  border:0;
  border-radius:0;

  grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
}

#couleurs .obra-tile{
  position:relative;
  border-radius:0;
  overflow:visible;
  background:transparent;
  box-shadow:none;
}

#couleurs .obra-tile img{
  display:block;
  width:100%;
  height:auto;           /* ratio naturel */
  object-fit:contain;    /* sécurité */
  margin:0;
  border:0;
}

/* accessibilité focus */
#couleurs .obra-tile a{
  position:absolute;
  inset:0;
  display:block;
  text-indent:-9999px;
}
#couleurs .obra-tile a:focus-visible{
  outline:2px solid rgba(0,0,0,.35);
  outline-offset:-2px;
}

/* =========================
   Lightbox (zoom image) — filet maigre
   ========================= */
.lightbox{
  position:fixed;
  inset:0;
  z-index:999;
  display:none;
  pointer-events:none;
}

.lightbox.open{
  display:block;
  pointer-events:auto;
}

.lb-backdrop{
  position:absolute;
  inset:0;
  background: rgba(240,240,243,.78);
  backdrop-filter: blur(10px);
}

.lb-figure{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:0;
  padding:36px 64px;
  box-sizing:border-box;
}

#lbImg{
  max-width: min(92vw, 1300px);
  max-height: 86vh;
  width:auto;
  height:auto;
  display:block;
  object-fit: contain; /* aucun crop */
  box-shadow:none;
}

/* Boutons (croix + nav) */
.lb-close,
.lb-nav{
  position:absolute;
  border:0;
  background:transparent;
  padding:10px;
  cursor:pointer;
  color: rgba(17,17,17,.75);
}

.lb-close:hover,
.lb-nav:hover{
  color: rgba(17,17,17,1);
}

.lb-close{
  top:18px;
  right:18px;
}

.lb-nav{
  top:50%;
  transform: translateY(-50%);
}

.lb-prev{ left:16px; }
.lb-next{ right:16px; }

/* SVG filet maigre */
.lb-close svg,
.lb-nav svg{
  width:22px;
  height:22px;
  display:block;
}

.lb-close svg path,
.lb-nav svg path{
  fill:none;
  stroke: currentColor;
  stroke-width: 1.2;
  stroke-linecap: round;
  stroke-linejoin: round;
}

/* focus clavier */
.lb-close:focus-visible,
.lb-nav:focus-visible{
  outline:2px solid rgba(0,0,0,.25);
  outline-offset:3px;
  border-radius:10px;
}

/* Mobile */
@media (max-width: 560px){
  .lb-figure{ padding:26px 46px; }
  .lb-prev{ left:8px; }
  .lb-next{ right:8px; }
  .lb-close{ top:10px; right:10px; }
}
</style>
</head>

<body>

<header class="header">
  <div class="header-inner">
    <a class="brand" href="#" id="homeLink">Un musée imaginaire</a>

    <nav class="nav" aria-label="Navigation">
      <button type="button" id="navHome">Accueil</button>
      <button type="button" id="navCouleurs">Couleurs</button>
      <button type="button" id="navPhotos">Photos</button>
    </nav>

    <div class="state" id="stateTxt">Accueil</div>
  </div>
</header>

<div class="spacer"></div>

<div class="stage">
  <div class="scene" id="scene">

    <!-- MOSAÏQUE (ACCUEIL) -->
    <div class="mosaic" id="mosaic">
      <img class="top" id="i1"
           src="https://avantpost-cpu.github.io/depot-quiz/gala2/intro1.jpg" alt="">

      <div class="cell2" id="cell2">
        <img id="i2" src="https://avantpost-cpu.github.io/depot-quiz/gala2/intro2.jpg" alt="">
        <a class="hotspot" href="#" aria-label="Afficher Couleurs" onclick="return false;"></a>
      </div>

      <img id="i3" src="https://avantpost-cpu.github.io/depot-quiz/gala2/intro3.jpg" alt="">

      <div class="cell4" id="cell4">
        <img id="i4" src="https://avantpost-cpu.github.io/depot-quiz/gala2/intro4.jpg" alt="">
        <a class="hotspot" href="#" aria-label="Afficher Photos" onclick="return false;"></a>
      </div>
    </div>

    <!-- OVERLAY COULEURS (mosaïque + lightbox) -->
    <div class="overlay" id="couleurs" aria-label="Couleurs">
      <div class="obra-grid" id="obraGrid" aria-label="Mosaïque des œuvres"></div>

      <!-- LIGHTBOX -->
      <div class="lightbox" id="lightbox" aria-hidden="true">
        <div class="lb-backdrop" id="lbBackdrop"></div>

        <figure class="lb-figure" role="dialog" aria-modal="true" aria-label="Agrandissement">
          <img id="lbImg" alt="">

          <!-- Close (croix filet maigre) -->
          <button class="lb-close" id="lbClose" type="button" aria-label="Fermer">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M6 6 L18 18 M18 6 L6 18"></path>
            </svg>
          </button>

          <!-- Prev / Next (pyramides filet maigre) -->
          <button class="lb-nav lb-prev" id="lbPrev" type="button" aria-label="Image précédente">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M15 5 L7 12 L15 19"></path>
            </svg>
          </button>

          <button class="lb-nav lb-next" id="lbNext" type="button" aria-label="Image suivante">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M9 5 L17 12 L9 19"></path>
            </svg>
          </button>
        </figure>
      </div>
    </div>

    <!-- OVERLAY PHOTOS (inchangé) -->
    <div class="overlay" id="photos">
      <img src="https://avantpost-cpu.github.io/depot-quiz/gala2/photos.png" alt="Photos">
    </div>

  </div>
</div>

<script>
/* Calage colonnes sur largeurs réelles (recomposition parfaite) */
const mosaic = document.getElementById("mosaic");
const ids = ["i2","i3","i4"];

function setColumns(){
  const imgs = ids.map(id => document.getElementById(id));
  if (imgs.some(img => !img.complete || !img.naturalWidth)) return;
  const w = imgs.map(img => img.naturalWidth);
  mosaic.style.gridTemplateColumns = `${w[0]}fr ${w[1]}fr ${w[2]}fr`;
}
window.addEventListener("load", setColumns);
ids.forEach(id => document.getElementById(id).addEventListener("load", setColumns));

/* =========================
   Génération page Couleurs = Obra_1..19
   ========================= */
const obraGrid = document.getElementById("obraGrid");
const OBRA_BASE = "https://avantpost-cpu.github.io/depot-quiz/gala2/";
const OBRA_COUNT = 19;

function obraUrl(i){
  return `${OBRA_BASE}Obra_${i}_bdf.jpg`;
}

function buildObraGrid(){
  const frag = document.createDocumentFragment();
  for (let i = 1; i <= OBRA_COUNT; i++){
    const tile = document.createElement("div");
    tile.className = "obra-tile";
    tile.dataset.index = String(i);

    const img = document.createElement("img");
    img.src = obraUrl(i);
    img.alt = `Œuvre ${i}`;
    img.loading = "lazy";

    const a = document.createElement("a");
    a.href = "#";
    a.setAttribute("aria-label", `Agrandir Œuvre ${i}`);
    a.addEventListener("click", (e) => {
      e.preventDefault();
      openLightbox(i);
    });

    tile.appendChild(img);
    tile.appendChild(a);
    frag.appendChild(tile);
  }
  obraGrid.innerHTML = "";
  obraGrid.appendChild(frag);
}
buildObraGrid();

/* =========================
   Lightbox logic
   ========================= */
const lightbox = document.getElementById("lightbox");
const lbBackdrop = document.getElementById("lbBackdrop");
const lbImg = document.getElementById("lbImg");
const lbClose = document.getElementById("lbClose");
const lbPrev = document.getElementById("lbPrev");
const lbNext = document.getElementById("lbNext");

let lbIndex = 1; // 1..OBRA_COUNT

function isLightboxOpen(){
  return lightbox.classList.contains("open");
}

function setLbImage(index){
  lbIndex = index;
  lbImg.src = obraUrl(lbIndex);
  lbImg.alt = `Œuvre ${lbIndex}`;
}

function openLightbox(index){
  // uniquement si Couleurs est bien ouverte
  if (lock !== "couleurs") return;

  setLbImage(index);
  lightbox.classList.add("open");
  lightbox.setAttribute("aria-hidden", "false");
  lbClose.focus({ preventScroll:true });
}

function closeLightbox(){
  lightbox.classList.remove("open");
  lightbox.setAttribute("aria-hidden", "true");
  lbImg.removeAttribute("src");
}

function prevImage(){
  const next = lbIndex - 1 < 1 ? OBRA_COUNT : lbIndex - 1;
  setLbImage(next);
}

function nextImage(){
  const next = lbIndex + 1 > OBRA_COUNT ? 1 : lbIndex + 1;
  setLbImage(next);
}

/* Actions */
lbClose.addEventListener("click", closeLightbox);
lbBackdrop.addEventListener("click", closeLightbox);
lbPrev.addEventListener("click", prevImage);
lbNext.addEventListener("click", nextImage);

/* Preview (hover) + Lock (clic) + Menu */
const scene = document.getElementById("scene");
const cell2 = document.getElementById("cell2");
const cell4 = document.getElementById("cell4");
const stateTxt = document.getElementById("stateTxt");

const navHome = document.getElementById("navHome");
const navCouleurs = document.getElementById("navCouleurs");
const navPhotos = document.getElementById("navPhotos");
const homeLink = document.getElementById("homeLink");

let lock = null; // null | "couleurs" | "photos"

function setStateLabel(){
  stateTxt.textContent = lock === "couleurs" ? "Couleurs"
                     : lock === "photos"   ? "Photos"
                     : "Accueil";
}
setStateLabel();

function setPreview(kind){
  if (lock) return;
  scene.classList.toggle("preview-couleurs", kind === "couleurs");
  scene.classList.toggle("preview-photos",   kind === "photos");
}

function clearPreview(){
  if (lock) return;
  scene.classList.remove("preview-couleurs","preview-photos");
}

function setLock(kind){
  lock = kind;

  // si on quitte Couleurs, on ferme la lightbox
  if (kind !== "couleurs" && isLightboxOpen()) closeLightbox();

  scene.classList.remove("preview-couleurs","preview-photos");
  scene.classList.toggle("lock-couleurs", kind === "couleurs");
  scene.classList.toggle("lock-photos",   kind === "photos");
  setStateLabel();
}

function clearLock(){
  lock = null;
  if (isLightboxOpen()) closeLightbox();
  scene.classList.remove("lock-couleurs","lock-photos");
  clearPreview();
  setStateLabel();
}

/* Hover = preview (zones intro2 / intro4) */
cell2.addEventListener("mouseenter", () => setPreview("couleurs"));
cell2.addEventListener("mouseleave", clearPreview);

cell4.addEventListener("mouseenter", () => setPreview("photos"));
cell4.addEventListener("mouseleave", clearPreview);

/* Clic sur zones = lock */
cell2.querySelector(".hotspot").addEventListener("click", (e) => {
  e.preventDefault();
  setLock("couleurs");
});
cell4.querySelector(".hotspot").addEventListener("click", (e) => {
  e.preventDefault();
  setLock("photos");
});

/* Menu = navigation d’état */
function stop(e){ e.preventDefault(); }
navHome.addEventListener("click", () => clearLock());
navCouleurs.addEventListener("click", () => setLock("couleurs"));
navPhotos.addEventListener("click", () => setLock("photos"));
homeLink.addEventListener("click", (e) => { stop(e); clearLock(); });

/* Clavier : lightbox prioritaire, sinon retour accueil */
window.addEventListener("keydown", (e) => {
  if (isLightboxOpen()){
    if (e.key === "Escape"){
      e.preventDefault();
      closeLightbox();
    }
    if (e.key === "ArrowLeft"){
      e.preventDefault();
      prevImage();
    }
    if (e.key === "ArrowRight"){
      e.preventDefault();
      nextImage();
    }
    return;
  }

  if (e.key === "Escape" && lock){
    e.preventDefault();
    clearLock();
  }
});

/* Access clavier : focus sur hotspot */
function makeKeyboard(cell, kind){
  const hs = cell.querySelector(".hotspot");
  hs.addEventListener("focus", () => setPreview(kind));
  hs.addEventListener("blur",  clearPreview);
  hs.addEventListener("keydown", (e) => {
    if (e.key === "Enter" || e.key === " "){
      e.preventDefault();
      setLock(kind);
    }
    if (e.key === "Escape"){
      e.preventDefault();
      clearLock();
    }
  });
}
makeKeyboard(cell2, "couleurs");
makeKeyboard(cell4, "photos");
</script>

</body>
</html>
