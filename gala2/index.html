<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Un musée imaginaire</title>

<style>
:root{
  --bg:#f0f0f3;
  --bgCouleurs:#e1e0dc;
  --txt:#111;
  --muted:rgba(17,17,17,.62);
  --hair:rgba(17,17,17,.12);

  --maxW:1100px;

  /* ✅ échelles séparées */
  --homeScale:.78;            /* accueil */
  --couleursScale:.88;        /* mosaïque Couleurs (desktop) */

  --ease:cubic-bezier(.22, 1, .36, 1);
  --tBg:900ms;
}

*{ box-sizing:border-box; }

html{
  min-height:100%;
  background:var(--bg);
  color:var(--txt);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  transition:background-color var(--tBg) var(--ease);
}
body{
  margin:0;
  min-height:100vh;
  background:inherit;
  color:inherit;
}

/* ✅ fond Couleurs jusqu’en bas */
html.bg-couleurs{ background:var(--bgCouleurs); }
body.bg-couleurs{ background:inherit; }

/* =========================
   Header
   ========================= */
.header{
  position:sticky;
  top:0;
  z-index:10;
  background:linear-gradient(to bottom, rgba(240,240,243,.92), rgba(240,240,243,.76));
  backdrop-filter:blur(8px);
  border-bottom:1px solid var(--hair);
  transition:background var(--tBg) var(--ease);
  padding-top:env(safe-area-inset-top, 0px);
}
html.bg-couleurs .header{
  background:linear-gradient(to bottom, rgba(225,224,220,.92), rgba(225,224,220,.76));
}

.header-inner{
  max-width:var(--maxW);
  margin:0 auto;
  padding:12px 14px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

.brand{
  font-size:14px;
  font-weight:600;
  letter-spacing:.22px;
  text-decoration:none;
  color:inherit;
  white-space:nowrap;
}

.nav{
  display:flex;
  gap:12px;
  font-size:13px;
  letter-spacing:.18px;
  align-items:center;
}
.nav button{
  appearance:none;
  border:0;
  background:none;
  padding:8px 8px;
  margin:0;
  cursor:pointer;
  color:var(--muted);
  font:inherit;
  border-radius:10px;
}
.nav button:hover{ color:var(--txt); }
.nav button:focus-visible{
  outline:2px solid rgba(0,0,0,.25);
  outline-offset:2px;
}

.state{
  font-size:12px;
  color:rgba(17,17,17,.5);
  letter-spacing:.15px;
  white-space:nowrap;
}

@media (max-width:560px){
  .header-inner{ flex-wrap:wrap; gap:8px 10px; }
  .state{ order:3; width:100%; }
}

/* =========================
   Scène
   ========================= */
.spacer{ height:10px; }

.stage{
  width:100%;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:0;
}

.scene{
  position:relative;
  width:100%;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  overflow:hidden;

  perspective:1900px;
  perspective-origin:50% 18%;
}

/* =========================
   MOSAÏQUE INTRO (ACCUEIL)
   ========================= */
.mosaic{
  display:grid;
  gap:0;
  line-height:0;
  font-size:0;
  background:#fff;
  overflow:hidden;
  max-width:100vw;

  transform:scale(var(--homeScale));
  transform-origin:top center;

  transition:
    transform 1.25s var(--ease),
    opacity   1.25s var(--ease),
    filter    1.25s var(--ease);
  will-change:transform,opacity,filter;
}

.mosaic img{
  display:block;
  width:100%;
  height:auto;
  margin:0;
  padding:0;
  border:0;
}
.top{ grid-column:1 / -1; }

.cell2,.cell4{ position:relative; overflow:hidden; }
.hotspot{
  position:absolute;
  inset:0;
  display:block;
  background:transparent;
  cursor:pointer;
  -webkit-tap-highlight-color:transparent;
}

/* accueil plus petit sur mobile */
@media (max-width:560px){
  :root{
    --homeScale:.62;
    --couleursScale:.92; /* Couleurs reste lisible, juste un peu réduite */
  }
}

/* =========================
   OVERLAYS (centrés, width fluide)
   ========================= */
.overlay{
  position:absolute;
  top:0;
  left:0;
  right:0;
  margin:0 auto;

  width:min(96vw, var(--maxW));
  transform-origin:top center;

  opacity:0;
  filter:blur(3px);
  pointer-events:none;

  transition:
    transform 1.35s var(--ease),
    opacity   1.35s var(--ease),
    filter    1.35s var(--ease);
  will-change:transform,opacity,filter;
}

/* mobile: overlay full width + padding */
@media (max-width:560px){
  .overlay{
    width:100vw;
    padding:0 12px;
  }
}

.scene.preview-couleurs #couleurs,
.scene.preview-photos #photos,
.scene.lock-couleurs #couleurs,
.scene.lock-photos #photos{
  transition-delay:90ms,90ms,90ms;
}

/* départ plus loin */
#couleurs{ transform: translateX(-46%) rotateY(18deg) translateZ(-120px) scale(.92); }
#photos{   transform: translateX(46%)  rotateY(-18deg) translateZ(-120px) scale(.92); }
#photos img{ width:100%; height:auto; display:block; }

/* PREVIEW */
.scene.preview-couleurs .mosaic{
  transform: translateX(30%) rotateY(-14deg) translateZ(-60px) scale(calc(var(--homeScale) * .98));
  opacity:0;
  filter:blur(2px);
}
.scene.preview-couleurs #couleurs{
  transform: translateX(0%) rotateY(0deg) translateZ(0px) scale(1);
  opacity:1;
  filter:blur(0);
}

.scene.preview-photos .mosaic{
  transform: translateX(-30%) rotateY(14deg) translateZ(-60px) scale(calc(var(--homeScale) * .98));
  opacity:0;
  filter:blur(2px);
}
.scene.preview-photos #photos{
  transform: translateX(0%) rotateY(0deg) translateZ(0px) scale(1);
  opacity:1;
  filter:blur(0);
}

/* LOCK */
.scene.lock-couleurs .mosaic,
.scene.lock-photos .mosaic{
  opacity:0;
  filter:blur(2px);
}
.scene.lock-couleurs .mosaic{
  transform: translateX(30%) rotateY(-14deg) translateZ(-60px) scale(calc(var(--homeScale) * .98));
}
.scene.lock-photos .mosaic{
  transform: translateX(-30%) rotateY(14deg) translateZ(-60px) scale(calc(var(--homeScale) * .98));
}

.scene.lock-couleurs #couleurs{
  transform: translateX(0%) rotateY(0deg) translateZ(0px) scale(1);
  opacity:1;
  filter:blur(0);
  pointer-events:auto;
}
.scene.lock-photos #photos{
  transform: translateX(0%) rotateY(0deg) translateZ(0px) scale(1);
  opacity:1;
  filter:blur(0);
  pointer-events:auto;
}

/* mobile : 3D adoucie */
@media (max-width:560px){
  .scene{ perspective:1200px; }

  #couleurs{ transform: translateX(-28%) rotateY(10deg) translateZ(-70px) scale(.95); }
  #photos{   transform: translateX(28%)  rotateY(-10deg) translateZ(-70px) scale(.95); }

  .scene.preview-couleurs .mosaic,
  .scene.lock-couleurs .mosaic{
    transform: translateX(18%) rotateY(-9deg) translateZ(-35px) scale(calc(var(--homeScale) * 1.02));
  }
  .scene.preview-photos .mosaic,
  .scene.lock-photos .mosaic{
    transform: translateX(-18%) rotateY(9deg) translateZ(-35px) scale(calc(var(--homeScale) * 1.02));
  }
}

/* =========================
   PAGE COULEURS (mosaïque réduite comme l’accueil)
   ✅ on “wrap” la grille et on scale
   ========================= */
#couleurs .couleurs-wrap{
  transform: scale(var(--couleursScale));
  transform-origin: top center;
  width:100%;
}

/* grille */
#couleurs .obra-grid{
  width:100%;
  display:grid;
  gap:0;
  padding:0;
  grid-template-columns:repeat(5, 1fr);
}

#couleurs .obra-tile{ position:relative; }
#couleurs .obra-tile img{
  display:block;
  width:100%;
  height:auto;
  object-fit:contain;
}
#couleurs .obra-tile a{
  position:absolute;
  inset:0;
  display:block;
  text-indent:-9999px;
  -webkit-tap-highlight-color:transparent;
}
#couleurs .obra-tile a:focus-visible{
  outline:2px solid rgba(0,0,0,.35);
  outline-offset:-2px;
}

/* breakpoints (lisibles) */
@media (max-width:1100px){
  #couleurs .obra-grid{ grid-template-columns:repeat(4, 1fr); }
}
@media (max-width:820px){
  #couleurs .obra-grid{ grid-template-columns:repeat(3, 1fr); }
}
@media (max-width:560px){
  /* 2 colonnes = grandes vignettes sur mobile */
  #couleurs .obra-grid{ grid-template-columns:repeat(2, 1fr); }
}

/* =========================
   Lightbox (swipe + défilement images sur mobile)
   ========================= */
.lightbox{
  position:fixed;
  inset:0;
  z-index:999;
  display:none;
  pointer-events:none;
}
.lightbox.open{ display:block; pointer-events:auto; }

.lb-backdrop{
  position:absolute;
  inset:0;
  background:rgba(240,240,243,.78);
  backdrop-filter:blur(10px);
  transition:background-color var(--tBg) var(--ease);
}
html.bg-couleurs .lb-backdrop{ background:rgba(225,224,220,.82); }

.lb-figure{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:0;
  padding:
    calc(28px + env(safe-area-inset-top, 0px))
    calc(52px + env(safe-area-inset-right, 0px))
    calc(28px + env(safe-area-inset-bottom, 0px))
    calc(52px + env(safe-area-inset-left, 0px));
}

/* ✅ conteneur swipe : on capte le geste même si l’image est petite */
.lb-swipe{
  width:100%;
  height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  touch-action: pan-y; /* ✅ autorise scroll vertical, bloque pan-x pour swipe */
}

#lbImg{
  max-width:min(94vw, 1400px);
  max-height:86vh;
  width:auto;
  height:auto;
  display:block;
  object-fit:contain;
}

.lb-close,.lb-nav{
  position:absolute;
  border:0;
  background:transparent;
  padding:14px;
  cursor:pointer;
  color:rgba(17,17,17,.75);
  border-radius:14px;
  -webkit-tap-highlight-color:transparent;
}
.lb-close:hover,.lb-nav:hover{ color:rgba(17,17,17,1); }

.lb-close{
  top:calc(10px + env(safe-area-inset-top, 0px));
  right:calc(10px + env(safe-area-inset-right, 0px));
}
.lb-nav{ top:50%; transform:translateY(-50%); }
.lb-prev{ left:calc(6px + env(safe-area-inset-left, 0px)); }
.lb-next{ right:calc(6px + env(safe-area-inset-right, 0px)); }

.lb-close svg,.lb-nav svg{ width:22px; height:22px; display:block; }
.lb-close svg path,.lb-nav svg path{
  fill:none;
  stroke:currentColor;
  stroke-width:1.2;
  stroke-linecap:round;
  stroke-linejoin:round;
}

@media (max-width:560px){
  .lb-figure{
    padding:
      calc(18px + env(safe-area-inset-top, 0px))
      calc(44px + env(safe-area-inset-right, 0px))
      calc(18px + env(safe-area-inset-bottom, 0px))
      calc(44px + env(safe-area-inset-left, 0px));
  }
  #lbImg{ max-height:82vh; }
}

@media (prefers-reduced-motion:reduce){
  *{ transition:none !important; }
}
</style>
</head>

<body>

<header class="header">
  <div class="header-inner">
    <a class="brand" href="#" id="homeLink">Un musée imaginaire</a>

    <nav class="nav" aria-label="Navigation">
      <button type="button" id="navHome">Accueil</button>
      <button type="button" id="navCouleurs">Couleurs</button>
      <button type="button" id="navPhotos">Photos</button>
    </nav>

    <div class="state" id="stateTxt">Accueil</div>
  </div>
</header>

<div class="spacer"></div>

<div class="stage">
  <div class="scene" id="scene">

    <!-- MOSAÏQUE (ACCUEIL) -->
    <div class="mosaic" id="mosaic">
      <img class="top" id="i1" src="https://avantpost-cpu.github.io/depot-quiz/gala2/intro1.jpg" alt="">

      <div class="cell2" id="cell2">
        <img id="i2" src="https://avantpost-cpu.github.io/depot-quiz/gala2/intro2.jpg" alt="">
        <a class="hotspot" href="#" aria-label="Afficher Couleurs" onclick="return false;"></a>
      </div>

      <img id="i3" src="https://avantpost-cpu.github.io/depot-quiz/gala2/intro3.jpg" alt="">

      <div class="cell4" id="cell4">
        <img id="i4" src="https://avantpost-cpu.github.io/depot-quiz/gala2/intro4.jpg" alt="">
        <a class="hotspot" href="#" aria-label="Afficher Photos" onclick="return false;"></a>
      </div>
    </div>

    <!-- OVERLAY COULEURS -->
    <div class="overlay" id="couleurs" aria-label="Couleurs">
      <!-- ✅ wrap pour scale (réduction mosaïque Couleurs) -->
      <div class="couleurs-wrap">
        <div class="obra-grid" id="obraGrid" aria-label="Mosaïque des œuvres"></div>
      </div>

      <!-- LIGHTBOX -->
      <div class="lightbox" id="lightbox" aria-hidden="true">
        <div class="lb-backdrop" id="lbBackdrop"></div>

        <figure class="lb-figure" role="dialog" aria-modal="true" aria-label="Agrandissement">
          <div class="lb-swipe" id="lbSwipe" aria-hidden="true">
            <img id="lbImg" alt="">
          </div>

          <button class="lb-close" id="lbClose" type="button" aria-label="Fermer">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M6 6 L18 18 M18 6 L6 18"></path>
            </svg>
          </button>

          <button class="lb-nav lb-prev" id="lbPrev" type="button" aria-label="Image précédente">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M15 5 L7 12 L15 19"></path>
            </svg>
          </button>

          <button class="lb-nav lb-next" id="lbNext" type="button" aria-label="Image suivante">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M9 5 L17 12 L9 19"></path>
            </svg>
          </button>
        </figure>
      </div>
    </div>

    <!-- OVERLAY PHOTOS -->
    <div class="overlay" id="photos" aria-label="Photos">
      <img src="https://avantpost-cpu.github.io/depot-quiz/gala2/photos.png" alt="Photos">
    </div>

  </div>
</div>

<script>
/* Calage colonnes sur largeurs réelles (recomposition parfaite) */
const mosaic = document.getElementById("mosaic");
const ids = ["i2","i3","i4"];

function setColumns(){
  const imgs = ids.map(id => document.getElementById(id));
  if (imgs.some(img => !img.complete || !img.naturalWidth)) return;
  const w = imgs.map(img => img.naturalWidth);
  mosaic.style.gridTemplateColumns = `${w[0]}fr ${w[1]}fr ${w[2]}fr`;
}
window.addEventListener("load", setColumns);
ids.forEach(id => document.getElementById(id).addEventListener("load", setColumns));

/* =========================
   Génération Couleurs = Obra_1..20
   ========================= */
const obraGrid = document.getElementById("obraGrid");
const OBRA_BASE = "https://avantpost-cpu.github.io/depot-quiz/gala2/";
const OBRA_COUNT = 20;

function obraUrl(i){ return `${OBRA_BASE}Obra_${i}_bdf.jpg`; }

function buildObraGrid(){
  const frag = document.createDocumentFragment();
  for (let i = 1; i <= OBRA_COUNT; i++){
    const tile = document.createElement("div");
    tile.className = "obra-tile";
    tile.dataset.index = String(i);

    const img = document.createElement("img");
    img.src = obraUrl(i);
    img.alt = `Œuvre ${i}`;
    img.loading = "lazy";
    img.decoding = "async";

    const a = document.createElement("a");
    a.href = "#";
    a.setAttribute("aria-label", `Agrandir Œuvre ${i}`);
    a.addEventListener("click", (e) => {
      e.preventDefault();
      openLightbox(i);
    });

    tile.appendChild(img);
    tile.appendChild(a);
    frag.appendChild(tile);
  }
  obraGrid.innerHTML = "";
  obraGrid.appendChild(frag);
}
buildObraGrid();

/* =========================
   Lightbox + swipe mobile (défilement)
   ========================= */
const lightbox = document.getElementById("lightbox");
const lbBackdrop = document.getElementById("lbBackdrop");
const lbImg = document.getElementById("lbImg");
const lbSwipe = document.getElementById("lbSwipe");
const lbClose = document.getElementById("lbClose");
const lbPrev = document.getElementById("lbPrev");
const lbNext = document.getElementById("lbNext");

let lbIndex = 1;

function isLightboxOpen(){ return lightbox.classList.contains("open"); }
function setLbImage(index){
  lbIndex = index;
  lbImg.src = obraUrl(lbIndex);
  lbImg.alt = `Œuvre ${lbIndex}`;
}
function openLightbox(index){
  if (lock !== "couleurs") return;
  setLbImage(index);
  lightbox.classList.add("open");
  lightbox.setAttribute("aria-hidden","false");
  document.documentElement.style.overflow="hidden";
  document.body.style.overflow="hidden";
  lbClose.focus({ preventScroll:true });
}
function closeLightbox(){
  lightbox.classList.remove("open");
  lightbox.setAttribute("aria-hidden","true");
  lbImg.removeAttribute("src");
  document.documentElement.style.overflow="";
  document.body.style.overflow="";
}
function prevImage(){ setLbImage(lbIndex - 1 < 1 ? OBRA_COUNT : lbIndex - 1); }
function nextImage(){ setLbImage(lbIndex + 1 > OBRA_COUNT ? 1 : lbIndex + 1); }

lbClose.addEventListener("click", closeLightbox);
lbBackdrop.addEventListener("click", closeLightbox);
lbPrev.addEventListener("click", prevImage);
lbNext.addEventListener("click", nextImage);

/* ✅ Swipe (mobile) : on swipe sur le conteneur, pas seulement l’image */
let sx = null;
let sy = null;

lbSwipe.addEventListener("touchstart", (e) => {
  if (!e.touches || !e.touches.length) return;
  sx = e.touches[0].clientX;
  sy = e.touches[0].clientY;
}, { passive:true });

lbSwipe.addEventListener("touchend", (e) => {
  if (sx === null || sy === null) return;
  const t = (e.changedTouches && e.changedTouches.length) ? e.changedTouches[0] : null;
  if (!t){ sx = sy = null; return; }

  const dx = t.clientX - sx;
  const dy = t.clientY - sy;
  sx = sy = null;

  /* on ignore si geste plutôt vertical */
  if (Math.abs(dy) > Math.abs(dx)) return;

  if (Math.abs(dx) < 40) return; /* seuil */
  if (dx > 0) prevImage();
  else nextImage();
}, { passive:true });

/* =========================
   Preview + Lock + Menu + fond
   ========================= */
const scene = document.getElementById("scene");
const cell2 = document.getElementById("cell2");
const cell4 = document.getElementById("cell4");
const stateTxt = document.getElementById("stateTxt");
const navHome = document.getElementById("navHome");
const navCouleurs = document.getElementById("navCouleurs");
const navPhotos = document.getElementById("navPhotos");
const homeLink = document.getElementById("homeLink");

let lock = null;

function setStateLabel(){
  stateTxt.textContent = lock === "couleurs" ? "Couleurs"
                     : lock === "photos"   ? "Photos"
                     : "Accueil";
}
function syncBg(){
  document.documentElement.classList.toggle("bg-couleurs", lock === "couleurs");
  document.body.classList.toggle("bg-couleurs", lock === "couleurs");
}
setStateLabel(); syncBg();

function setPreview(kind){
  if (lock) return;
  scene.classList.toggle("preview-couleurs", kind === "couleurs");
  scene.classList.toggle("preview-photos",   kind === "photos");
}
function clearPreview(){
  if (lock) return;
  scene.classList.remove("preview-couleurs","preview-photos");
}
function setLock(kind){
  lock = kind;
  if (kind !== "couleurs" && isLightboxOpen()) closeLightbox();
  scene.classList.remove("preview-couleurs","preview-photos");
  scene.classList.toggle("lock-couleurs", kind === "couleurs");
  scene.classList.toggle("lock-photos",   kind === "photos");
  setStateLabel();
  syncBg();
}
function clearLock(){
  lock = null;
  if (isLightboxOpen()) closeLightbox();
  scene.classList.remove("lock-couleurs","lock-photos");
  clearPreview();
  setStateLabel();
  syncBg();
}

/* Hover desktop */
cell2.addEventListener("mouseenter", () => setPreview("couleurs"));
cell2.addEventListener("mouseleave", clearPreview);
cell4.addEventListener("mouseenter", () => setPreview("photos"));
cell4.addEventListener("mouseleave", clearPreview);

/* Clic zones */
cell2.querySelector(".hotspot").addEventListener("click", (e)=>{ e.preventDefault(); setLock("couleurs"); });
cell4.querySelector(".hotspot").addEventListener("click", (e)=>{ e.preventDefault(); setLock("photos"); });

/* Menu */
function stop(e){ e.preventDefault(); }
navHome.addEventListener("click", clearLock);
navCouleurs.addEventListener("click", ()=>setLock("couleurs"));
navPhotos.addEventListener("click", ()=>setLock("photos"));
homeLink.addEventListener("click", (e)=>{ stop(e); clearLock(); });

/* Clavier */
window.addEventListener("keydown", (e) => {
  if (isLightboxOpen()){
    if (e.key === "Escape"){ e.preventDefault(); closeLightbox(); }
    if (e.key === "ArrowLeft"){ e.preventDefault(); prevImage(); }
    if (e.key === "ArrowRight"){ e.preventDefault(); nextImage(); }
    return;
  }
  if (e.key === "Escape" && lock){ e.preventDefault(); clearLock(); }
});
</script>

</body>
</html>
