<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Quiz sur le stress post-traumatique</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
      background-image: url('https://avantpost-cpu.github.io/depot-quiz/livre/fond.jpg');
      background-repeat: repeat;
      background-size: auto;
    }

    #instructions {
      margin-bottom: 20px;
      font-size: 16px;
      line-height: 1.5;
    }

    .question-title {
      background-color: white;
      color: #26667c;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 15px;
      font-weight: bold;
    }

    .question {
      margin-bottom: 25px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #26667c;
      color: white;
    }

    button {
      display: block;
      margin: 5px 0;
      padding: 10px;
      width: 100%;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      font-size: 15px;
    }

    #validateBtn {
      background-color: white;
      color: #26667c;
      font-weight: bold;
      margin-top: 15px;
    }

    #validateBtn:hover {
      background-color: #e5e5e5;
    }

    #startImage, #nextImage {
      display: block;
      margin: 20px auto;
      max-width: 260px;
      cursor: pointer;
    }

    #nextImage { display:none; }

    #startImage:hover, #nextImage:hover {
      opacity: 0.85;
      transition: 0.2s;
    }

    .correct { color: #74ff74; font-weight: bold; }
    .wrong { color: #ff6f6f; font-weight: bold; }

    #score {
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      margin-top: 20px;
      display: none;
    }

    .result-img {
      max-width: 60%;
      display: block;
      margin: 20px auto;
    }

    #progress {
      text-align: center;
      margin-bottom: 10px;
      font-weight: bold;
      display: none;
    }
  </style>
</head>

<body>

  <div style="text-align:center; margin-bottom:20px;">
    <img src="https://avantpost-cpu.github.io/depot-quiz/titrestress.png"
         alt="Titre Stress Post-Traumatique"
         style="max-width:60%; height:auto;">
  </div>

  <p id="instructions">
    Testez vos connaissances sur les cons√©quences psychologiques du traumatisme.
    Une correction et le temps de r√©ponse appara√Ætront apr√®s chaque question.
  </p>

  <img id="startImage"
       src="https://avantpost-cpu.github.io/depot-quiz/button.png"
       alt="Commencer le quiz">

  <div id="progress"></div>
  <div id="quiz"></div>

  <button id="validateBtn" style="display:none;">Valider la r√©ponse</button>

  <img id="nextImage"
       src="https://avantpost-cpu.github.io/depot-quiz/suivante.png"
       alt="Question suivante">

  <div id="score"></div>
  <div id="resultImage"></div>

  <script>
    var questions = [
      { text: "Quels sympt√¥mes peuvent r√©v√©ler un stress post-traumatique ?",
        answers: [
          { text: "Hypervigilance", correct: true },
          { text: "Sur-habillement", correct: true },
          { text: "Cauchemars r√©currents", correct: true },
          { text: "Changement de r√©gime alimentaire", correct: true }
        ],
        multiple: true
      },
      { text: "Quel comportement montre une conduite d‚Äô√©vitement ?",
        answers: [
          { text: "Absence aux entra√Ænements", correct: true },
          { text: "Prendre plus de photos", correct: false },
          { text: "Augmenter les r√©seaux sociaux", correct: false }
        ],
        multiple: false
      },
      { text: "Quel trouble inclut des pens√©es r√©p√©titives et compulsions ?",
        answers: [
          { text: "TOC", correct: true },
          { text: "D√©pression", correct: false },
          { text: "Sid√©ration", correct: false }
        ],
        multiple: false
      },
      { text: "Quels signes physiques peuvent appara√Ætre chez une victime ?",
        answers: [
          { text: "Blessures inexpliqu√©es", correct: true },
          { text: "Cicatrices de naissance", correct: false },
          { text: "Mauvais go√ªt alimentaire", correct: false }
        ],
        multiple: false
      },
      { text: "Qu‚Äôest-ce que la dissociation ?",
        answers: [
          { text: "Se sentir d√©tach√© de soi-m√™me", correct: true },
          { text: "Sauter de joie", correct: false },
          { text: "Manger plus", correct: false }
        ],
        multiple: false
      },
      { text: "Quels comportements inhabituels peuvent √™tre des signes de traumatisme ?",
        answers: [
          { text: "Isolement social", correct: true },
          { text: "Hypervigilance", correct: true },
          { text: "Regarder la t√©l√©", correct: false }
        ],
        multiple: true
      },

      /* ‚≠ê‚≠ê‚≠ê QUESTION MODIFI√âE ENTIEREMENT ‚≠ê‚≠ê‚≠ê */
      { text: "Qu‚Äôest-ce qui peut √™tre un signe de stress post-traumatique ?",
        answers: [
          { text: "Les addictions", correct: true },
          { text: "Les conduites √† risque", correct: true },
          { text: "Les troubles du sommeil", correct: true },
          { text: "Les comportements violents", correct: true }  /* AJOUT√â */
        ],
        multiple: true   /* üëâ maintenant MULTIPLE */
      }
    ];

    var currentQuestion = 0;
    var score = 0;
    var startTime = 0;

    var quizContainer = document.getElementById("quiz");
    var progress = document.getElementById("progress");
    var nextImage = document.getElementById("nextImage");
    var validateBtn = document.getElementById("validateBtn");

    function shuffleArray(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}

    function showQuestion() {
      nextImage.style.display = "none";
      validateBtn.style.display = "none";

      if (currentQuestion >= questions.length) return endQuiz();

      var q = questions[currentQuestion];
      var answers = q.answers.slice();
      shuffleArray(answers);

      progress.style.display = "block";
      progress.textContent = "Question " + (currentQuestion+1) + " / " + questions.length;

      var html = `<div class="question">
                    <div class="question-title">${q.text}</div>`;

      answers.forEach(a => {
        if (q.multiple) {
          html += `<label><input type="checkbox" value="${a.text}"> ${a.text}</label><br>`;
        } else {
          html += `<button onclick="answerSingle(${a.correct})">${a.text}</button>`;
        }
      });

      html += `<p id="feedback"></p></div>`;
      quizContainer.innerHTML = html;

      if (q.multiple) validateBtn.style.display = "block";

      startTime = performance.now();
    }

    function answerSingle(correct) { showFeedback(correct); }

    validateBtn.onclick = function () {
      var q = questions[currentQuestion];
      var boxes = quizContainer.querySelectorAll("input[type='checkbox']");
      var allCorrect = true;
      var checkedCount = 0;

      boxes.forEach(cb => {
        var ans = q.answers.find(a => a.text === cb.value);
        if (cb.checked) checkedCount++;
        if (cb.checked !== ans.correct) allCorrect = false;
      });

      /* ‚≠ê Correction sp√©ciale pour DERNI√àRE QUESTION */
      if (q.text.includes("Qu‚Äôest-ce qui peut √™tre un signe de stress post-traumatique")) {
        if (checkedCount !== q.answers.length) {
          showSpecialFeedback();
          return;
        }
      }

      showFeedback(allCorrect);
    };

    function showSpecialFeedback() {
      var end = performance.now();
      var time = Math.round((end - startTime) / 1000);

      var fb = document.getElementById("feedback");
      fb.innerHTML =
        `<strong>Chaque r√©ponse repr√©sente un signe de stress post-traumatique.</strong><br>
         <span style="opacity:0.7;">‚è± Temps : <strong>${time}s</strong></span>`;

      nextImage.style.display = "block";
      validateBtn.style.display = "none";
    }

    function showFeedback(correct) {
      var end = performance.now();
      var time = Math.round((end - startTime) / 1000);

      var fb = document.getElementById("feedback");

      fb.innerHTML =
        (correct ? "‚úÖ Bonne r√©ponse !" : "‚ùå Mauvaise r√©ponse.") +
        `<br><span style="opacity:0.7;">‚è± Temps : <strong>${time}s</strong></span>`;

      if (correct) score++;

      nextImage.style.display = "block";
      validateBtn.style.display = "none";
    }

    nextImage.onclick = function () {
      currentQuestion++;
      showQuestion();
    };

    function endQuiz() {
      quizContainer.innerHTML = "";
      nextImage.style.display = "none";
      validateBtn.style.display = "none";
      progress.textContent = "";

      var sc = document.getElementById("score");
      sc.style.display = "block";
      sc.textContent = `R√©sultat final : ${score} / ${questions.length}`;

      var img = document.getElementById("resultImage");

      if (score >= Math.ceil(questions.length * 0.7)) {
        img.innerHTML = `<img src="https://avantpost-cpu.github.io/depot-quiz/bravo.png" class="result-img">`;
      } else {
        img.innerHTML = `<img src="https://avantpost-cpu.github.io/depot-quiz/progres.png" class="result-img">`;
      }
    }

    document.getElementById("startImage").onclick = function () {
      this.style.display = "none";
      showQuestion();
    };
  </script>
</body>
</html>
