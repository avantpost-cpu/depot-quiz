<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tâches Rebond</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: #000;
      font-family: Arial, sans-serif;
    }

    #billes-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    #fond {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: contain;  /* IMPORTANT : pour garder les vraies limites */
      left: 0;
      top: 0;
      z-index: 1;
      pointer-events: none;
    }

    .bille {
      position: absolute;
      width: 100px;
      pointer-events: none;
      z-index: 2;
      user-select: none;
    }
  </style>
</head>

<body>

<div id="billes-container">
  <!-- Ton image réelle -->
  <img id="fond" src="https://avantpost-cpu.github.io/depot-quiz/taches/taches.jpg">
</div>

<script>
/* -----------------------------------------------------------
   CONFIG
----------------------------------------------------------- */
const dossier = "https://avantpost-cpu.github.io/depot-quiz/taches/";
const images = ["a.png","b.png","c.png","d.png","e.png","f.png","g.png","h.png","i.png","j.png"];

// vitesse ultra lente
const SPEED_MIN = 0.05;
const SPEED_MAX = 0.20;

// vraie résolution image taches.jpg
const fondoW = 2480;
const fondoH = 3508;

/* -----------------------------------------------------------
   BASE
----------------------------------------------------------- */
const container = document.getElementById("billes-container");
const fond = document.getElementById("fond");
const billes = [];

/* -----------------------------------------------------------
   CALCUL DE LA ZONE VISIBLE EXACTE DU FOND
----------------------------------------------------------- */
function calcZoneVisible() {
  const cw = container.clientWidth;
  const ch = container.clientHeight;

  const ratioImg = fondoW / fondoH;
  const ratioWin = cw / ch;

  let zone = {};

  // Même logique que object-fit: contain
  if (ratioWin > ratioImg) {
    // bandes latérales
    const visibleW = ch * ratioImg;
    const offsetX = (cw - visibleW) / 2;
    zone = {
      x: offsetX,
      y: 0,
      width: visibleW,
      height: ch
    };
  } else {
    // bandes haut/bas
    const visibleH = cw / ratioImg;
    const offsetY = (ch - visibleH) / 2;
    zone = {
      x: 0,
      y: offsetY,
      width: cw,
      height: visibleH
    };
  }

  return zone;
}

/* -----------------------------------------------------------
   CREATION DES BILLES
----------------------------------------------------------- */
function initBilles() {
  const zone = calcZoneVisible();

  images.forEach(file => {
    const img = document.createElement("img");
    img.src = dossier + file;
    img.className = "bille";
    container.appendChild(img);

    const angle = Math.random() * Math.PI * 2;
    const speed = SPEED_MIN + Math.random() * (SPEED_MAX - SPEED_MIN);

    const bille = {
      el: img,
      x: zone.x + Math.random() * (zone.width - 100),
      y: zone.y + Math.random() * (zone.height - 100),
      vx: Math.cos(angle) * speed,
      vy: Math.sin(angle) * speed
    };

    billes.push(bille);
    respirer(bille);
  });
}

/* -----------------------------------------------------------
   ANIMATION RESPIRATION
----------------------------------------------------------- */
function respirer(bille) {
  const newScale = 0.85 + Math.random() * 0.4;
  const duration = 2000 + Math.random() * 3000;

  bille.el.style.transition = `transform ${duration}ms ease-in-out`;
  bille.el.style.transform = `scale(${newScale})`;

  setTimeout(() => respirer(bille), duration);
}

/* -----------------------------------------------------------
   ANIMATION DU DEPLACEMENT
----------------------------------------------------------- */
function animer() {
  const zone = calcZoneVisible();

  billes.forEach(bille => {
    bille.x += bille.vx;
    bille.y += bille.vy;

    if (bille.x <= zone.x || bille.x >= zone.x + zone.width - 100) {
      bille.vx *= -1;
    }
    if (bille.y <= zone.y || bille.y >= zone.y + zone.height - 100) {
      bille.vy *= -1;
    }

    bille.el.style.left = bille.x + "px";
    bille.el.style.top = bille.y + "px";
  });

  requestAnimationFrame(animer);
}

/* -----------------------------------------------------------
   INIT
----------------------------------------------------------- */
window.onload = () => {
  initBilles();
  animer();
};

window.onresize = () => {
  billes.length = 0;
  document.querySelectorAll(".bille").forEach(b => b.remove());
  initBilles();
};
</script>

</body>
</html>
