<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Tâches – Rebond</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    background: #000;
    font-family: Arial, sans-serif;
  }

  #billes-container {
    width: 100vw;
    height: 100vh;
    position: relative;
    overflow: hidden;
  }

  /* ⭐ VRAIE IMAGE DE FOND (fond.jpg) */
  #fond {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    object-fit: contain; /* garantit qu’elle n’est pas rognée */
    pointer-events: none;
    user-select: none;
    z-index: 1;
  }

  .bille {
    position: absolute;
    width: 100px;
    pointer-events: none;
    user-select: none;
    z-index: 2;
  }
</style>
</head>

<body>

<div id="billes-container">
  <img id="fond" src="https://avantpost-cpu.github.io/depot-quiz/taches/fond.jpg" alt="">
</div>

<script>
/* -----------------------------------------------------
   CONFIG
----------------------------------------------------- */
const images = [
  "a.png","b.png","c.png","d.png","e.png",
  "f.png","g.png","h.png","i.png","j.png"
].map(x => "https://avantpost-cpu.github.io/depot-quiz/taches/" + x);

// vitesses lentes
const SPEED_MIN = 0.05;
const SPEED_MAX = 0.20;

// dimensions réelles du fichier fond.jpg
// ⚠️ Mets ici les bonnes dimensions (en pixels EXACTES)
const fondoW = 2480;   // ← ajustable
const fondoH = 3508;   // ← ajustable

const container = document.getElementById("billes-container");
const fond = document.getElementById("fond");
const billes = [];

/* -----------------------------------------------------
   CALCUL EXACT DE LA ZONE VISIBLE DU FOND
----------------------------------------------------- */
function zoneVisible() {
  const cw = container.clientWidth;
  const ch = container.clientHeight;
  const ratioImg = fondoW / fondoH;
  const ratioWin = cw / ch;

  if (ratioWin > ratioImg) {
    // bandes latérales
    const visibleW = ch * ratioImg;
    const offsetX = (cw - visibleW) / 2;
    return { x: offsetX, y: 0, width: visibleW, height: ch };
  } else {
    // bandes haut / bas
    const visibleH = cw / ratioImg;
    const offsetY = (ch - visibleH) / 2;
    return { x: 0, y: offsetY, width: cw, height: visibleH };
  }
}

/* -----------------------------------------------------
   CRÉATION DES BILLES
----------------------------------------------------- */
function initBilles() {
  const zone = zoneVisible();

  images.forEach(url => {
    const img = document.createElement("img");
    img.src = url;
    img.className = "bille";
    container.appendChild(img);

    const angle = Math.random() * Math.PI * 2;
    const speed = SPEED_MIN + Math.random() * (SPEED_MAX - SPEED_MIN);

    const bille = {
      el: img,
      x: zone.x + Math.random() * (zone.width - 100),
      y: zone.y + Math.random() * (zone.height - 100),
      vx: Math.cos(angle) * speed,
      vy: Math.sin(angle) * speed
    };

    respirer(bille);
    billes.push(bille);
  });
}

/* -----------------------------------------------------
   RESPIRATION
----------------------------------------------------- */
function respirer(bille) {
  const scale = 0.85 + Math.random() * 0.4;
  const duration = 2000 + Math.random() * 3000;

  bille.el.style.transition = `transform ${duration}ms ease-in-out`;
  bille.el.style.transform = `scale(${scale})`;

  setTimeout(() => respirer(bille), duration);
}

/* -----------------------------------------------------
   ANIMATION
----------------------------------------------------- */
function animate() {
  const zone = zoneVisible();

  billes.forEach(bille => {
    bille.x += bille.vx;
    bille.y += bille.vy;

    if (bille.x < zone.x || bille.x > zone.x + zone.width - 100) bille.vx *= -1;
    if (bille.y < zone.y || bille.y > zone.y + zone.height - 100) bille.vy *= -1;

    bille.el.style.left = bille.x + "px";
    bille.el.style.top = bille.y + "px";
  });

  requestAnimationFrame(animate);
}

/* -----------------------------------------------------
   INIT
----------------------------------------------------- */
window.onload = () => {
  initBilles();
  animate();
};

window.onresize = () => {
  billes.length = 0;
  document.querySelectorAll(".bille").forEach(b => b.remove());
  initBilles();
};
</script>

</body>
</html>
