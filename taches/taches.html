<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Tâches – Rebond</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    background: #e4e4e4;
    font-family: Arial, sans-serif;
  }

  #billes-container {
    width: 100vw;
    height: 100vh;
    position: relative;
    overflow: hidden;
  }

  /* ⭐ IMAGE DE FOND */
  #fond {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: contain;
    left: 0;
    top: 0;
    pointer-events: none;
    z-index: 1;
  }

  /* ⭐ BILLES NORMALES */
  .bille {
    position: absolute;
    width: 100px;
    pointer-events: auto;
    user-select: none;
    z-index: 2;
    transition: none !important; /* Empêche les transitions lentes */
  }

  /* ⭐ SUPERPOSITION BLEUE (effet garanti même sur PNG noir) */
  .bille::after {
    content: "";
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 140, 255, 0); /* invisible par défaut */
    mix-blend-mode: lighten; /* Permet de coloriser du noir */
    transition: none !important;
    border-radius: 50%;
    pointer-events: none;
  }

  /* ⭐ HOVER : BLEU PUR + GROSSISSEMENT IMMÉDIAT */
  .bille:hover {
    transform: scale(2.8) !important;  
    transition: none !important;
    z-index: 20;
  }

  .bille:hover::after {
    background: rgba(0, 140, 255, 1); /* bleu pur */
    transition: none !important;
  }
</style>
</head>

<body>

<div id="billes-container">
  <img id="fond" src="https://avantpost-cpu.github.io/depot-quiz/taches/fond.jpg" alt="">
</div>

<script>
/* -----------------------------------------------------
   CONFIG
----------------------------------------------------- */
const images = [
  "a.png","b.png","c.png","d.png","e.png",
  "f.png","g.png","h.png","i.png","j.png"
].map(x => "https://avantpost-cpu.github.io/depot-quiz/taches/" + x);

const SPEED_MIN = 0.05;
const SPEED_MAX = 0.20;

const fondoW = 2480; /* dimensions réelles du JPEG */
const fondoH = 3508;

const container = document.getElementById("billes-container");
const billes = [];

/* -----------------------------------------------------
   ZONE VISIBLE (object-fit: contain)
----------------------------------------------------- */
function zoneVisible() {
  const cw = container.clientWidth;
  const ch = container.clientHeight;
  const ratioImg = fondoW / fondoH;
  const ratioWin = cw / ch;

  if (ratioWin > ratioImg) {
    const visibleW = ch * ratioImg;
    const offsetX = (cw - visibleW) / 2;
    return { x: offsetX, y: 0, width: visibleW, height: ch };
  } else {
    const visibleH = cw / ratioImg;
    const offsetY = (ch - visibleH) / 2;
    return { x: 0, y: offsetY, width: cw, height: visibleH };
  }
}

/* -----------------------------------------------------
   CRÉATION DES BILLES
----------------------------------------------------- */
function initBilles() {
  const zone = zoneVisible();

  images.forEach(url => {
    const img = document.createElement("img");
    img.src = url;
    img.className = "bille";
    container.appendChild(img);

    const angle = Math.random() * Math.PI * 2;
    const speed = SPEED_MIN + Math.random() * (SPEED_MAX - SPEED_MIN);

    const bille = {
      el: img,
      x: zone.x + Math.random() * (zone.width - 100),
      y: zone.y + Math.random() * (zone.height - 100),
      vx: Math.cos(angle) * speed,
      vy: Math.sin(angle) * speed
    };

    billes.push(bille);
    respirer(bille);
  });
}

/* -----------------------------------------------------
   RESPIRATION (désactivée en hover)
----------------------------------------------------- */
function respirer(bille) {

  if (bille.el.matches(':hover')) {
    setTimeout(() => respirer(bille), 300);
    return;
  }

  const scale = 0.85 + Math.random() * 0.4;
  const duration = 2000 + Math.random() * 2000;

  bille.el.style.transition = `transform ${duration}ms ease-in-out`;
  bille.el.style.transform = `scale(${scale})`;

  setTimeout(() => respirer(bille), duration);
}

/* -----------------------------------------------------
   ANIMATION GÉNÉRALE
----------------------------------------------------- */
function animate() {
  const zone = zoneVisible();

  billes.forEach(bille => {
    bille.x += bille.vx;
    bille.y += bille.vy;

    if (bille.x < zone.x || bille.x > zone.x + zone.width - 100) bille.vx *= -1;
    if (bille.y < zone.y || bille.y > zone.y + zone.height - 100) bille.vy *= -1;

    bille.el.style.left = bille.x + "px";
    bille.el.style.top  = bille.y + "px";
  });

  requestAnimationFrame(animate);
}

/* -----------------------------------------------------
   INIT
----------------------------------------------------- */
window.onload = () => {
  initBilles();
  animate();
};

window.onresize = () => {
  billes.length = 0;
  document.querySelectorAll(".bille").forEach(b => b.remove());
  initBilles();
};
</script>

</body>
</html>
